%!PS
%%BoundingBox: 0 0 300 300
/mm { 72 25.4 div mul } bind def
/inch { 72 mul } bind def

/font-size 5 def
/text-line-clearance 0.3 mm def   % Text above measure line
/text-spacing 0.5 mm def          % Leave at least this amount to next tick

/inner-radius 20 mm def
/outer-radius 55 mm def

/pitch 0.5 mm def                 % Pitch of our measure screw
/turns 3 mm pitch div def         % Turns: depends on maximum measure distance

/strip-fill-fraction 0.75 def  % What width of the spiral text strip is used.

/strip-width outer-radius inner-radius sub turns div def
/PI 3.1415926 def

0 setlinewidth
/Helvetica findfont font-size scalefont setfont
outer-radius dup translate

% rotate-pos (text)
/write-at {
    1 dict begin
    /txt exch def
    /rotate-pos exch def
    /radius outer-radius rotate-pos pitch div strip-width mul sub def
    gsave
    rotate-pos pitch div 360 mul rotate
    % tick mark:
    radius neg 0 moveto strip-width strip-fill-fraction mul 0 rlineto stroke

    radius neg strip-width strip-fill-fraction mul add txt stringwidth pop sub
    text-line-clearance moveto txt show
    grestore
    rotate-pos
      font-size text-line-clearance text-spacing add add   % Amount we want to clear
      radius PI mul 2 mul  % Full diameter at current pos
      div                  % Fraction of a turn until we're clear
      pitch mul
      add
    end
} def

% millimeter -> (txt)
/gen-measure-text {
    1000 mul cvi (       ) cvs
} def

/next -1 def
0 0.0001 3 {
    /sag-in-mm exch def
    sag-in-mm mm next ge {
	sag-in-mm mm
	sag-in-mm gen-measure-text
	write-at
	/next exch def
    } if
} for

showpage
